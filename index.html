<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App 3</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Montserrat Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
    </style>
    <style>
        /* Toast styling */
        body {
            background: #fafafa;
            padding-left: 30px;
            padding-right: 30px;
    
        }
        
        #download_icon:hover {
            opacity: .7;
        }
        
        .colored-toast.swal2-icon-success {
            background-color: #a5dc86 !important;
        }
        
        .colored-toast.swal2-icon-error {
            background-color: #f27474 !important;
        }
        
        .colored-toast.swal2-icon-warning {
            background-color: #f8bb86 !important;
        }
        
        .colored-toast.swal2-icon-info {
            background-color: #3fc3ee !important;
        }
        
        .colored-toast.swal2-icon-question {
            background-color: #87adbd !important;
        }
        
        .colored-toast .swal2-title {
            color: white;
        }
        
        .colored-toast .swal2-close {
            color: white;
        }
        
        .colored-toast .swal2-html-container {
            color: white;
        }
        
        /* Aqteq CSS */
        
        .center_div_within_row {
            display: flex;
            /* justify-content: center; */
            align-items: center;
        }
        
        table {
            /* border-collapse: separate; */
        }
        
        .table_row_header {
            background:#f0f0f1;
        }
        
        .table_row_header_CMP {
            background:#f0f0f1;
        }
        
        .source_id_header {
            background:#f0f0f1;
        }
        
        .streamer_id_header {
            background:#f0f0f1;
        }
        
        .table {
            cursor: pointer;
            margin-bottom: 35px;
        }
        
        .table td {
            padding: .5rem;
        }
        
        .table th {
            padding: .5rem;
        }
        
        .streamer_offset_header {
            width: 50px;
        }
        
        .inline_setback_header {
            width: 50px;
        }
        
        .table_row_header {
            width:160px;
        }
        
        .table_row_header_CMP {
            width:50px;
        }
        
        .source_offset_header {
            width: 50px;
        }
        
        .results {
            font-weight: 600;
        }
        
        .card {
            box-shadow: rgb(65 78 66 / 8%) 0 2px 8px 0;
            border: 0.3px solid #80808061;
            border-radius: 10px;
        }
        
        .row {
            margin-bottom: 5px;
        }
        
        div {
            font-family: "Montserrat";
            font-size: 14px;
        }
        
        .inputs_card {
            margin: 20px;
        }
        
        .inputs_card_bottom_row {
            margin-top:20px;
        }
        
        .inputs_title {
            white-space: nowrap;
            margin: auto;
            width: 50%;
        }
        
        .results_line {
            margin: 20px 0px 0px 0px
        }  
        
        .input {
            background-color: #fff;
            border: 1px solid #939393; /* eff0f6; */
            border-radius: 15px;
            box-shadow: rgba(27, 25, 121, .05) 0 2px 8px 0;
            box-sizing: border-box;
            color: #0b0a33;
            cursor: text;
            display: block;
            font-family: 'Montserrat';
            /* font-size: 18px;
            font-weight: 500; */
            height: 15px;
            line-height: 1.111em;
            min-height: 15px;
            padding:15px 20px;
            transition: box-shadow 300ms,color 300ms,border-color 300ms;
            /* vertical-align: middle; */
            width: 80%;
        }
        
        .input:focus {
            transition: 'box-shadow' 300ms,color 300ms,'border-color' 300ms;
            bordeR: 1px solid black;
            box-shadow: rgb(129 129 129 / 12%) 0 2px 8px 0;
        }
        
        
        .dropdown {
            background-color: #fff;
            border: 1px solid #939393; /* eff0f6; */
            border-radius: 15px;
            box-shadow: rgba(27, 25, 121, .05) 0 2px 8px 0;
            box-sizing: border-box;
            color: #0b0a33;
            cursor: text;
            display: block;
            font-family: 'Montserrat';
            line-height: 1.111em;
            padding: 5px 15px;
            transition: box-shadow 300ms,color 300ms,border-color 300ms;
            /* vertical-align: middle; */
            width: 80%;
        }
        
        .dropdown:focus {
            transition: 'box-shadow' 300ms,color 300ms,'border-color' 300ms;
            bordeR: 1px solid black;
            box-shadow: rgb(129 129 129 / 12%) 0 2px 8px 0;
        }
        
        .error {
            font-weight: bold;
        }
        
        
        .input_error_tip[data-tip] {
            position:relative;
            z-index: 99999!important;
        }
        
        .input_error_tip[data-tip]:before {
            content:'';
            /* hides the tooltip when not hovered */
            display:none;
            content:'';
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid #000000bf;	
            position:absolute;
            top:30px;
            left:35px;
            z-index:8;
            font-size:0;
            line-height:0;
            width:0;
            height:0;
        }
        
        .input_error_tip[data-tip]:after {
            display: none;
            content: attr(data-tip);
            position: absolute;
            top: 35px;
            left: 0px;
            padding: 8px 12px;
            background: #000000bf;
            color: #fff;
            z-index: 9;
            font-size: 14px;
            font-family: 'Montserrat';
            height: 100%;
            line-height: 18px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            white-space: nowrap;
            word-wrap: normal;
        }
        
        .input_error_tip[data-tip]:hover:before,
        
        .input_error_tip[data-tip]:hover:after {
            display:block;
        }
        
        .result_error {
            background: #ffa50073;
            border-radius: 12px;
        }
        
        .result_error[data-title]:hover:after {
            opacity: 1;
            transition: all 0.1s ease 0.5s;
            visibility: visible;
        }
        
        .result_error[data-title]:after {
            content: attr(data-title);
            background-color: #fffcc1de;
            color: #111;
            font-size: 15px;
            font-weight: bold;
            position: absolute;
            padding: 1px 5px 2px 5px;
            bottom: -1.6em;
            left: 100%;
            /* white-space: nowrap; */
            box-shadow: 1px 1px 3px #222222;
            width: 165px;
            border: 1px solid #111111;
            z-index: 99999;
            font-family: 'Montserrat';
            border-radius: 10px;
            opacity: 0;
            visibility: hidden;
        }
        
        .result_error[data-title] {
            position: relative;
        }
        
        .error[data-title]:hover:after {
            opacity: 1;
            transition: all 0.1s ease 0.5s;
            visibility: visible;
        }
        
        .error[data-title]:after {
            content: attr(data-title);
            background-color: #f3153eeb;
            color: #111;
            font-size: 15px;
            font-weight: bold;
            position: absolute;
            padding: 1px 5px 2px 5px;
            bottom: -1.6em;
            left: 100%;
            /* white-space: nowrap; */
            box-shadow: 1px 1px 3px #222222;
            width: 165px;
            border: 1px solid #111111;
            z-index: 99999;
            font-family: 'Montserrat';
            border-radius: 10px;
            opacity: 0;
            visibility: none;
        }
        
        .error[data-title] {
            position: relative;
        }
        
        .js-plotly-plot .plotly .modebar--hover > :not(.watermark) {
            opacity: 1 !important;
        }
        .input_error {
            font-weight: bold;
            background-color: #ff00343d;
            box-shadow: rgb(255 12 57 / 67%) 0 0px 10px 0;
            /* border-top: none !important; */
        }
        
        .top_cards {
            max-width: 600px;
        }
        table td:hover {
            background-color: rgba(0,0,0,.075);
        }
        
        
        
        
        .results_line {
            /* box-shadow: rgb(65 78 66 / 8%) 0 2px 8px 0;
            border: 0.3px solid #80808061; */
            border-radius: 10px;
            padding: 2px;
        }
        
        .results_line .row {
            margin-bottom: none;
            /* margin: 5px 0px; */
        }
        
        #Results .results_line {
            margin: 5px 0px 0px 0px;
        }
        
        #OVT_Analysis .results_line {
            margin: 5px 0px 0px 0px;
        }
        
        .calculation_error {
            background: #e7e7e7;
            cursor: pointer;
        }
        
        .calculation_error[data-title]:hover:after {
            opacity: 1;
            transition: all 0.1s ease 0.5s;
            visibility: visible;
        }
        
        .calculation_error[data-title]:after {
            content: attr(data-title);
            background-color: #dfdfdfde;
            color: #111;
            font-size: 15px;
            font-weight: bold;
            position: absolute;
            padding: 1px 5px 2px 5px;
            bottom: -1em;
            left: 100%;
            /* white-space: nowrap; */
            box-shadow: 1px 1px 3px #222222;
            width: 165px;
            border: 1px solid #111111;
            z-index: 99999;
            font-family: 'Montserrat';
            border-radius: 10px;
            opacity: 0;
            visibility: hidden;
        }
        
        .calculation_error[data-title] {
            position: relative;
        }
        
        
        
        
        /* art */
        
        .results_line2 {
            margin: 20px 0px 0px 0px
        }  
        
        .results_line2 {
            box-shadow: rgb(65 78 66 / 8%) 0 2px 8px 0;
            border: 0.3px solid #80808061;
            border-radius: 10px;
            padding: 2px;
        }
        
        .results_line2 .row {
            margin-bottom: none;
            margin: 5px 0px;
        }
        
        #Results .results_line2 {
            margin: 5px 0px 0px 0px;
        }
        
        sub {
            bottom: 0em;
        }
        
        .lowered_sub {
            bottom: -.2em !important;
            font-weight: 500;
        }
            
        .error {
            font-weight: bold;
        }
        
        
        .input_error_tip[data-tip] {
            position:relative;
        }
        
        .input_error_tip[data-tip]:before {
            content:'';
            /* hides the tooltip when not hovered */
            display:none;
            content:'';
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid #000000bf;	
            position:absolute;
            top:30px;
            left:35px;
            z-index:8;
            font-size:0;
            line-height:0;
            width:0;
            height:0;
        }
        
        .input_error_tip[data-tip]:after {
            display: none;
            content: attr(data-tip);
            position: absolute;
            top: 35px;
            left: 0px;
            padding: 8px 12px;
            background: #000000bf;
            color: #fff;
            z-index: 9;
            font-size: 14px;
            font-family: 'Montserrat';
            height: 100%;
            line-height: 18px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            white-space: nowrap;
            word-wrap: normal;
        }
        
        .input_error_tip[data-tip]:hover:before,
        
        .input_error_tip[data-tip]:hover:after {
            display:block;
        }
        
        .result_error {
            background: #ffa50073;
            border-radius: 12px;
        }
        
        .result_error[data-title]:hover:after {
            opacity: 1;
            transition: all 0.1s ease 0.5s;
            visibility: visible;
        }
        
        .result_error[data-title]:after {
            content: attr(data-title);
            background-color: #fffcc1de;
            color: #111;
            font-size: 15px;
            font-weight: bold;
            position: absolute;
            padding: 1px 5px 2px 5px;
            bottom: -1.6em;
            left: 100%;
            /* white-space: nowrap; */
            box-shadow: 1px 1px 3px #222222;
            width: 165px;
            border: 1px solid #111111;
            z-index: 99999;
            font-family: 'Montserrat';
            border-radius: 10px;
            opacity: 0;
            visibility: hidden;
        }
        
        .result_error[data-title] {
            position: relative;
        }
        
        .error[data-title]:hover:after {
            opacity: 1;
            transition: all 0.1s ease 0.5s;
            visibility: visible;
        }
        
        .error[data-title]:after {
            content: attr(data-title);
            background-color: #f3153eeb;
            color: #111;
            font-size: 15px;
            font-weight: bold;
            position: absolute;
            padding: 1px 5px 2px 5px;
            bottom: -1.6em;
            left: 100%;
            /* white-space: nowrap; */
            box-shadow: 1px 1px 3px #222222;
            width: 165px;
            border: 1px solid #111111;
            z-index: 99999;
            font-family: 'Montserrat';
            border-radius: 10px;
            opacity: 0;
            visibility: none;
        }
        
        .error[data-title] {
            position: relative;
        }
        
        .js-plotly-plot .plotly .modebar--hover > :not(.watermark) {
            opacity: 1 !important;
        }
        .input_error {
            font-weight: bold;
            background-color: #ff00343d;
            box-shadow: rgb(255 12 57 / 67%) 0 0px 10px 0;
            /* border-top: none !important; */
        }
        
        .switch-button {
            font-family: 'Montserrat';
            font-weight: 600;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
            background: rgb(207 207 207 / 56%);
            border-radius: 30px;
            overflow: hidden;
            width: 240px;
            text-align: center;
            font-size: 18px;
            letter-spacing: 1px;
            color: #000000;
            position: relative;
            padding-right: 120px;
            position: relative;
        }
        .switch-button:before {
            content: "Chart";
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            pointer-events: none;
        }
        .switch-button-checkbox {
            cursor: pointer;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 2;
        }
        .switch-button-checkbox:checked + .switch-button-label:before {
            transform: translateX(120px);
            transition: transform 300ms linear;
        }
        .switch-button-checkbox + .switch-button-label {
            position: relative;
            padding: 15px 0;
            display: block;
            user-select: none;
            pointer-events: none;
        }
        .switch-button-checkbox + .switch-button-label:before {
            content: "";
            background: #c1f9bd;
            height: 100%;
            width: 100%;
            position: absolute;
            left: 0;
            top: 0;
            border-radius: 30px;
            transform: translateX(0);
            transition: transform 300ms;
        }
        .switch-button-checkbox + .switch-button-label .switch-button-label-span {
            position: relative;
        }
        
        .animate__animated.animate__fadeIn {
            --animate-duration: .5s;
        }
        .animate__animated.animate__fadeOutDown {
            --animate-duration: 1.1s !important;
        }
    </style>    
</head>

<body>
    <div class="row">

        <!-- Inputs -->
        <div class="col-12 col-lg-3 col-sm-10 card inputs_card top_cards" id="Inputs" style="min-height: 700px;">
            <div class="card-body">
                <h4 class="card-title">Inputs</h4>
                <p class="card-text"></p>
    
                    <!-- Top Row -->
                    <div class="inputs_card_top_row">

                        <div class="row">
                            <div class="col-6 inputs_title">Individual Compressor<br>Capacity <sub>(<span class="">SCFM</span>)</sub></div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="individual_compressor_capacity" name="individual_compressor_capacity" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6 inputs_title"># of Compressors</div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="number_of_compressors" name="number_of_compressors" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6 inputs_title"># Used As "Spares"</div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="number_used_as_spares" name="number_used_as_spares" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6 inputs_title">Boat Speed <sub>(<span class="">Knots</span>)</sub></div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="boat_speed" name="boat_speed" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6 inputs_title">Array Volume To Be Fired<br><sub>(<span class="">cu.in</span>)</sub></div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="array_volume_to_be_fired" name="array_volume_to_be_fired" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6 inputs_title">Operating Pressure <sub>(<span class="">P.S.I.</span>)</sub></div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="operating_pressure" name="operating_pressure" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <br>
                        
                        <div class="row">
                            <div class="col-6 inputs_title">System Cycle Time</div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="system_cycle_time" name="system_cycle_time" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6 inputs_title">Required Shot Interval</div>
                            <div class="col-6">
                                <input onkeyup=checkInputs() class="input" type="text" id="required_shot_interval" name="required_shot_interval" placeholder="" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
                            </div>
                        </div>
                        
                    </div>
    
            </div>
        </div>


        <!-- Results -->
        <div class="col-12 col-lg-3  col-sm-12 card inputs_card top_cards animate__animated animate__fadeIn" id="Results">

            <div class="card-body">
                
                <h4 class="card-title">Results</h4>
               
                <p class="card-text"></p>

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Active Compressor Capacity</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="active_compressor_capacity"></div> <sub class="" style="bottom: -0.1em !important">&nbsp; <span class="">SCFM</span></sub>
                            </div>
                        </div>
                    </div>

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Minimum Shot Point Interval</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="minimum_shot_point_interval"></div> <sub class="" style="bottom: -0.1em !important">&nbsp; <span class="">meters</span></sub>
                            </div>
                        </div>
                    </div>

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Minimum Cycle Time</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="minimum_cycle_time"></div> <sub class="lowered_sub">&nbsp; <span class="">seconds</span></sub>
                            </div>
                        </div>
                    </div>
    
                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Slow Boat To</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="slow_boat_to"></div> <sub class="lowered_sub">&nbsp; <span class="">knots</span></sub>
                            </div>
                        </div>
                    </div>

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Reduce Pressure To</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="reduce_pressure_to"></div> <sub class="lowered_sub">&nbsp; <span class="">p.s.I.</span></sub>
                            </div>
                        </div>
                    </div>

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Reduce Array<br>Volume To</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="reduce_array_volume_to"></div> <sub class="">&nbsp; <span class="">cu.in</span></sub>
                            </div>
                        </div>
                    </div>

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Spare Compressor?</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="activate_a_spare_compressor"></div>
                            </div>
                        </div>
                    </div>

                    <!-- <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Shot Interval</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="shot_interval"></div> <sub><span class="">meters</span></sub>
                            </div>
                        </div>
                    </div> -->

                    <div class="results_line"  data-title="Calculation error!">
                        <div class="row">
                            <div class="col-6 results_title">Time Between<br>Shots</div>
                            <div class="col-6 center_div_within_row">
                                <div class="results" id="time_between_shots"></div> <sub class=""  style="bottom: -0.1em !important">&nbsp; <span class="">seconds</span></sub>
                            </div>
                        </div>
                    </div>
                    
            </div>

        </div>
        <!-- Results (END) -->


        <div class="col-12 col-lg-5  col-sm-12 card inputs_card top_cards animate__animated animate__fadeIn" id="Chart">
            <div id='chart' style="width: 100%; height: 100%"><!-- Plotly chart will be drawn inside this DIV --></div>
        </div>

    </div>
    
</body>

<!-- Jquery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- SweetAlert -->
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Plotly (Charts) -->
<script src='https://cdn.plot.ly/plotly-2.9.0.min.js'></script>
<!-- Auto Run Code on Load -->
<script>

    document.addEventListener('DOMContentLoaded', (event) => {
        autoTest()
    });

    function autoTest() {
        $('#individual_compressor_capacity').val(1200)
        $('#number_of_compressors').val(3)
        $('#number_used_as_spares').val(2)
        $('#boat_speed').val(5)
        $('#array_volume_to_be_fired').val(1300)
        $('#operating_pressure').val(2000)
        $('#system_cycle_time').val(0)
        $('#required_shot_interval').val(12.5)

        checkInputs()
    }

    function checkInputs() {
        let individual_compressor_capacity = $('#individual_compressor_capacity').val()
        let number_of_compressors = $('#number_of_compressors').val()
        let number_used_as_spares = $('#number_used_as_spares').val()
        let boat_speed = $('#boat_speed').val()
        let array_volume_to_be_fired = $('#array_volume_to_be_fired').val()
        let operating_pressure = $('#operating_pressure').val()
        let system_cycle_time = $('#system_cycle_time').val()
        let required_shot_interval = $('#required_shot_interval').val()

        let inputs = {
            'individual_compressor_capacity': parseFloat(individual_compressor_capacity),
            'number_of_compressors': parseFloat(number_of_compressors),
            'number_used_as_spares': parseFloat(number_used_as_spares),
            'boat_speed': parseFloat(boat_speed),
            'array_volume_to_be_fired': parseFloat(array_volume_to_be_fired),
            'operating_pressure': parseFloat(operating_pressure),
            'system_cycle_time': parseFloat(system_cycle_time),
            'required_shot_interval': parseFloat(required_shot_interval)
        }

        runCalculations(inputs)
    }

    function runCalculations(input) {
        let active_compressor_capacity = input['individual_compressor_capacity'] * ( input['number_of_compressors'] - input['number_used_as_spares'] )
        let minimum_shot_point_interval = (input['boat_speed'] * input['array_volume_to_be_fired'] * input['operating_pressure']) / (822.5 * active_compressor_capacity)
        let minimum_cycle_time = (input['array_volume_to_be_fired'] * input['operating_pressure']) / (423.4 * active_compressor_capacity)
        let slow_boat_to = 822.5 * active_compressor_capacity * input['required_shot_interval'] / (input['array_volume_to_be_fired'] * input['operating_pressure'])
        let reduce_pressure_to = 822.5 * active_compressor_capacity * input['required_shot_interval'] / (input['array_volume_to_be_fired'] * input['boat_speed'])
        let reduce_array_volume_to = 822.5 * active_compressor_capacity * input['required_shot_interval'] / (input['operating_pressure'] * input['boat_speed'])
        let activate_a_spare_compressor = (input['number_used_as_spares'] > 0 ? "True" : "False")
        let time_between_shots = input['required_shot_interval'] / (input['boat_speed'] * 0.5144) - input['system_cycle_time']

        let results = {
            'active_compressor_capacity': active_compressor_capacity,
            'minimum_shot_point_interval': minimum_shot_point_interval,
            'minimum_cycle_time': minimum_cycle_time,
            'slow_boat_to': slow_boat_to,
            'reduce_pressure_to': reduce_pressure_to,
            'reduce_array_volume_to': reduce_array_volume_to,
            'activate_a_spare_compressor': activate_a_spare_compressor,
            'time_between_shots': time_between_shots
        }

        setResults(results)

        let chart_data = generateChartData(input, results)
        generateChart(chart_data)
    }

    function setResults(results) {
        for (const [id, value] of Object.entries(results)) {
            if (typeof(value) == 'string') {
                $('#' + id).text(value)
            }
            else if (value.toString().includes('Infinity') == false && is_NaN(value) == false) // checks that the number IS NOT equal to "NaN" (i.e. error)
            {

                $('#' + id).parents().eq(2).removeClass('calculation_error') // calculation was not prone to error, restoring default class without error.

                if (value == parseInt(value) || value >= 1000) // If the value is large, show as a comma.
                {
                    $('#' + id).text(numberWithCommas(parseInt(round(value, 0))))
                }
                else
                {
                    $('#' + id).text(round(value, 2))
                }

            }
            else
            {
                // Error occured, setting result as blank and adding error data-tip class.
                $('#' + id).text('')
                $('#' + id).parents().eq(2).addClass('calculation_error')
            }
        }
    }

    function is_NaN(x) {
        return x !== x
    }

    function round(num, decimals) {
        let n = decimals.toString()
        return +(Math.round(num + `e+${n}`)  + `e-${n}`)
    }

    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }




    function generateChartData(input, result) {
        let column = []
        let row = []

        let chartData = []

        // COLUMN CALCULATIONS \\
        // ==================== \\
        // append the base line shot interval input
        column.push(input['required_shot_interval'])

        for (let i = 0; i < 5; i++) { // get lower half of column
            column.push(column[i] / Math.sqrt(2))
        }

        // Need to get the array in the correct order, dad made a weird function in excel, so this is going to look weird. If you're reading this funciton, I'm sorry...
        column.reverse()

        for (let i = 5; i < 10; i++) { // get upper half of column
            column.push(column[i] * Math.sqrt(2))
        }


        // ROW CALCULATIONS \\
        // ================= \\
        row.push(input['boat_speed'])

        for (let i = 0; i < 3; i++) { // get lower half of column
            row.push(row[i] - .5)
        }

        // Need to get the array in the correct order, dad made a weird function in excel, so this is going to look weird. If you're reading this funciton, I'm sorry...
        row.reverse()

        for (let i = 3; i < 6; i++) { // get upper half of column
            row.push(row[i] + .5)
        }

        trace_styling = {
            0: {'color': '#C5E0B4', 'line_type': 'dash'},
            1: {'color': '#C5E0B4', 'line_type': 'longdash'},
            2: {'color': '#C5E0B4', 'line_type': 'solid'},
            3: {'color': '#FFC000', 'line_type': 'solid'},
            4: {'color': '#B4C7E7', 'line_type': 'solid'},
            5: {'color': '#B4C7E7','line_type': 'longdash'},
            6: {'color': '#B4C7E7', 'line_type': 'dash'}
        }

        // Use row/col to calculation traces for the Chart
        for (let i = 0; i < column.length; i++) {
            for (let x = 0; x < row.length; x++) {

                let x_value = column[i]
                let y_value = 822.5 * result['active_compressor_capacity'] * column[i] / (row[x] * input['operating_pressure'])

                let trace = {
                    type: 'lines',
                    x: [ 0,  round(x_value, 1) ],
                    y: [ 0, round(y_value, 0) ],
                    mode: 'lines',
                    name: row[x],
                    line: {
                        color: trace_styling[x]['color'],
                        width: 3,
                        dash: trace_styling[x]['line_type']
                    }
                }


                if (i == 10) {
                    chartData.push(trace)
                }

            }    
        }

        return chartData

    }

    function generateChart(chart_data) {

        let x_values = []
        for (var i=0; i < chart_data.length; i++) {
            x_values.push(chart_data[i]['x'][1])
        }

        let y_values = []
        for (var i=0; i < chart_data.length; i++) {
            chart_data[i]['y'][1] ? y_values.push(chart_data[i]['y'][1]) : null
        }

        x_max = Math.max(...x_values)
        x_min = Math.min(...x_values)
        x_range = Math.abs(x_max) + Math.abs(x_min)
        y_max = Math.max(...y_values)

        Plotly.newPlot(
            'chart',
            chart_data,
            layout = {
                // height: 700,
                // width: 700,
                showlegend: true,
                legend: {
                    title: {
                        text: 'Vessel speed<br>(knots)<br>',
                        font: {
                            family: 'Montserrat',
                            size: 12,
                            color: '#7f7f7f', //'black'
                        }
                    }
                },
                xaxis: {
                    title: {
                        text: 'Shotpoint interval in m',
                        font: {
                            family: 'Montserrat',
                            size: 16,
                            color: '#7f7f7f' //'black'
                        }
                    },
                    showgrid: true,
                    range: [0, x_max * 1.1]
                },
                yaxis: {
                    tickformat: ",.0f",
                    title: {
                        text: 'Array volume',
                        font: {
                            family: 'Montserrat',
                            size: 16,
                            color: '#7f7f7f' //'black'
                        }
                    },
                    showgrid: true,
                    showline: true,
                    range: [(-y_max * .05), y_max * 1.1]
                },
                title: `Source Pressure ${$('#operating_pressure').val()} PSI | Compressor capacity ${$('#active_compressor_capacity').text()} SCFM`,
                images: [
                    {
                        x: 1.05,
                        y: -.15,
                        sizex: 0.10,
                        sizey: 0.10,
                        source: "https://static.wixstatic.com/media/6440e3_79209f11808643efaab19239b58ec2f9~mv2.png/v1/fill/w_172,h_93,al_c,usm_2.00_1.00_0.00,enc_auto/No_Background.png",
                        xanchor: "right",
                        xref: "paper",
                        yanchor: "bottom",
                        yref: "paper"
                    }
                ],
            },
            config={'modeBarButtonsToRemove': ["select", "lasso"], responsive: true, 'displaylogo': false}, // 'scrollZoom': true
        )

    }



</script>
</html>
